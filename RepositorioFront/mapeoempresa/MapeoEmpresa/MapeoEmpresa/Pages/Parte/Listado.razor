@using EntidadesNegocio.EntidadesDto;
@using EntidadesNegocio.InformacionVisita;
@using System.Numerics;
@inject EquipoService EquipoService;

<div class="contenedor-bloque col-lg-12">
    @if (ListPartes == null)
    {
        <p>Cargando...</p>
    }
    else if (ListPartes.Count == 0)
    {
        <p class="pt-3">No se han registrado partes para este equipo</p>
    }
    else
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID parte</th>
                    <th>Nombre elemento</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var p in ListPartes)
                {
                    <tr>
                        <td>@p.Id</td>
                        <td>@p.NombreElemento</td>
                        <td><button class="btn btn-danger" @onclick="() => AbrirModalBorrar(p.Id)"><i class="oi oi-x"></i></button></td>
                        <td><buton class="btn btn-info" @onclick="() => AbrirModalInformacion(p)"><i class="oi oi-info"></i></buton></td>
                    </tr>
                }
            </tbody>
        </table>
    }

</div>
<br />

@if (modalEliminar)
{
    <div class="modal" tabindex="-1" style="display:block">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @onclick=CerrarModal></button>
                </div>
                <div class="modal-body">
                    <p>¿Desea eliminar la parte con ID @ID?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal" @onclick=CerrarModal>Cancelar</button>
                    <button type="button" class="btn btn-success" @onclick=BorrarArea>Eliminar</button>
                </div>
            </div>
        </div>
    </div>
}

@if (modalInformacion)
{
    <div class="modal" tabindex="-1" style="display:block">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Información registrada</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" @onclick=CerrarModal></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="nombre">ID parte: </label>
                        <input type="text" class="form-control" id="id" value="@ParteDTO.Id" readonly>
                    </div>

                    <div class="form-group">
                        <label for="idElemento">ID elemento asociado: </label>
                        <input type="text" class="form-control" id="idElemento" value="@ParteDTO.IdElemento" readonly>
                    </div>

                    <div class="form-group">
                        <label class="required-field" for="nombreElemento">Nombre elemento: </label>
                        <input type="text" class="form-control" id="nombreElemento" value="@ParteDTO.NombreElemento" readonly>
                    </div>

                    <div class="row">
                        <div class="col-sm-4 mb-3">
                            <div class="form-group">
                                <label for="idEquipoo">ID equipo: </label>
                                <input type="text" class="form-control" id="idEquipo" value="@ParteDTO.IdEquipo" readonly>
                            </div>
                        </div>

                        <div class="col-sm-8 mb-3">
                            <div class="form-group">
                                <label class="required-field" for="nombreEquipo">Nombre equipo: </label>
                                <input type="text" class="form-control" id="nombreEquipo" value="@EquipoService.EquipoDTOSeleccionado.nombre" readonly>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
}

@code {
    List<ParteDTO> ListPartes;

    private bool modalEliminar = false;
    private bool modalInformacion = false;
    private BigInteger ID = 0;

    ParteDTO ParteDTO = new ParteDTO();

    protected override async Task OnInitializedAsync()
    {
        ListPartes= await EquipoService.ListarPartes();
    }

    private void CerrarModal()
    {
        modalEliminar = false;
        modalInformacion = false;
    }

    //LLAMADOS A MÉTODOS EN SERVICE

    protected async Task BorrarArea()
    {
        await EquipoService.BorrarParte(ID);
        modalEliminar = false;
        ListPartes= await EquipoService.ListarPartes();
    }

    //MODALES
    private void AbrirModalBorrar(BigInteger id)
    {
        modalEliminar = true;
        ID = id;
    }

    private void AbrirModalInformacion(ParteDTO parte)
    {
        modalInformacion = true;
        ParteDTO = parte;
    }
}
